/*
 * This file was generated by the Gradle 'init' task.
 *
 * This generated file contains a sample Gradle plugin project to get you started.
 * For more details on writing Custom Plugins, please refer to https://docs.gradle.org/8.10/userguide/custom_plugins.html in the Gradle documentation.
 * This project uses @Incubating APIs which are subject to change.
 */

plugins {
    // Apply the Java Gradle plugin development plugin to add support for developing Gradle plugins
    id 'java-gradle-plugin'
}

dependencies {
    api(project(':changelog'))
    api(project(':maven-publishing'))
    api(project(':resource-processing'))
    api(project(':jetbrains-annotations'))
    api(project(':scripting'))
    api(project(':java'))
    api(project(':sourceset-management'))
    api(project(':git'))
    api(project(':parchment'))
    api(project(':neogradle'))
    api(project(':curseforge'))
    api(project(':jarjar'))
    api(project(':shadowing'))
    api(project(':common'))
    api(project(':utilities'))
    api(project(':local-file-configuration'))
    api(project(':crowdin'))
}

gradlePlugin {
    // Define the plugin
    plugins {
        tableau {
            id = 'com.ldtteam.tableau.all'
            implementationClass = 'com.ldtteam.tableau.TableauPlugin'
        }
    }
}

def publishLocallyTask = tasks.register('publishLocally') {
    it.group = "publishing"
    it.description = "Publishes the project to the local repositories. Allows for the use of the bootstrap plugin in example projects."
}

allprojects { Project it ->
    it.plugins.apply('java')
    it.plugins.apply('maven-publish')

    it.version = it.findProperty("version")
    if (it.version == null || it.version.toString() == "unspecified") {
        it.version = "0.0.0-LOCAL"
    }
    it.group = 'com.ldtteam.tableau'

    it.java {
        withSourcesJar()
        withJavadocJar()
    }

    it.tasks.named('javadoc', Javadoc.class, { Javadoc task ->
        task.failOnError = true
        task.options.addStringOption('Werror', '-quiet')
    })

    it.publishing {
        publications {
            configureEach {
                suppressAllPomMetadataWarnings()
            }
        }

        repositories {
            maven {
                name = "LDTTeam-Tableau"
                url = uri('https://ldtteam.jfrog.io/artifactory/tableau-publishing/')
                credentials {
                    username = System.getenv('ARTIFACTORY_USERNAME')
                    password = System.getenv('ARTIFACTORY_PASSWORD')
                }
            }

            maven {
                name = "Directory"
                url = rootProject.layout.projectDirectory.dir("repo")
            }
        }
    }

    publishLocallyTask.configure { t -> t.dependsOn(it.tasks.named('publishToMavenLocal')) }
    publishLocallyTask.configure { t -> t.dependsOn(it.tasks.named('publishAllPublicationsToDirectoryRepository')) }
}